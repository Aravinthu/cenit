<div class="dropdown menu-api">
  <button class="btn btn-primary dropdown-toggle" type="button"
          title="<%= t('admin.actions.generate_api.curl.title') %>"
          data-toggle="dropdown">
    <span class="text">REST API</span>
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu dropdown-menu-right">
    <% api_current_paths.each do |path, methods| %>
        <% methods.each do |method, definition| %>
            <li>
              <a href="#" role="menuitem" title="<%= definition[:description].strip %>"
                 data-dlg-id="<%= "dlg-#{method}-#{path}".parameterize %>">
                <span class="label method <%= method %>"><%= method %></span>
                <span class="option"><%= definition[:summary].strip %></span>
              </a>
            </li>
        <% end %>
    <% end %>
  </ul>
</div>

<% api_current_paths.each do |path, methods| %>
    <% methods.each do |method, definition| %>
        <% dlg_id = "dlg-#{method}-#{path}".parameterize %>
        <div id="<%= dlg_id %>" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><%= definition[:summary].strip %>:</h4>
              </div>
              <div class="modal-body sdk-code">
                <p><%= definition[:description].strip %></p>
                <hr/>
                <p>
                  <span class="label method <%= method %>"><%= method %></span>
                  <span class="uri"><%= api_uri(method, path) %></span>
                </p>
                <hr/>

                <ul class="nav nav-tabs tabs-left">
                  <li class="active"><a data-toggle="tab" href="#<%= dlg_id %>-curl">cURL</a></li>
                  <li><a data-toggle="tab" href="#<%= dlg_id %>-jquery">jQuery</a></li>
                  <li><a data-toggle="tab" href="#<%= dlg_id %>-nodejs">NodeJS</a></li>
                  <li><a data-toggle="tab" href="#<%= dlg_id %>-php">PHP</a></li>
                  <li><a data-toggle="tab" href="#<%= dlg_id %>-python">Python</a></li>
                  <li><a data-toggle="tab" href="#<%= dlg_id %>-ruby">Ruby</a></li>
                </ul>

                <div class="tab-content">
                  <% %w(curl jquery nodejs php python ruby).each do |lang| %>
                      <div id="<%= "#{dlg_id}-#{lang}" %>" class="tab-pane fade in <%= "active" if lang == 'curl' %>">
                        <pre class="code"><%= api_code(lang, method, path).html_safe %></pre>
                      </div>
                  <% end %>
                </div>
              </div>
              <div class="modal-footer">
                <button id="copy-to-clipboard" type="button" class="btn btn-default"
                        data-clipboard-action="copy">Copy
                </button>
              </div>
            </div>
          </div>
        </div>
    <% end %>
<% end %>

<script type="text/javascript">
  var clipboard = new Clipboard('#copy-to-clipboard', {
    target: function (trigger) {
      return $('.modal-body:visible pre:visible')[0];
    }
  });

  $('.menu-api .dropdown-menu li a').on('click', function (e) {
    var dlg = $('#' + $(this).data('dlg-id'));

    // Move dlg to document body.
    if (!dlg.parent().is('body')) $('body').append(dlg);

    dlg.modal();
  });
</script>